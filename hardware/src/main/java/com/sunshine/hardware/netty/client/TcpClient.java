package com.sunshine.hardware.netty.client;

import com.cositea.gateway.message.MessageParent;
import com.cositea.gateway.service.CositeaMethod;
import com.cositea.gateway.util.ByteOps;
import com.sunshine.hardware.model.BraceletData;
import com.sunshine.hardware.netty.StringInitializer;
import com.sunshine.hardware.netty.handler.ServerHandler;
import io.netty.bootstrap.Bootstrap;
import io.netty.channel.Channel;
import io.netty.channel.EventLoopGroup;
import io.netty.channel.nio.NioEventLoopGroup;
import io.netty.channel.socket.nio.NioSocketChannel;
import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.nio.charset.Charset;

public class TcpClient {

    private static final Logger log = LoggerFactory.getLogger(TcpClient.class);

    private String ip;

    private int port;

    private boolean stop = false;

    public TcpClient(String ip, int port) {
        this.ip = ip;
        this.port = port;
    }

    public void run() throws IOException {
        //设置一个多线程循环器
        EventLoopGroup workerGroup = new NioEventLoopGroup();
        //启动附注类
        Bootstrap bootstrap = new Bootstrap();
        bootstrap.group(workerGroup);
        //指定所使用的NIO传输channel
        bootstrap.channel(NioSocketChannel.class);
        //指定客户端初始化处理
        bootstrap.handler(new ClientIniterHandler());
        try {
            //连接服务
            Channel channel = bootstrap.connect(ip, port).sync().channel();
            while (true) {
                //向服务端发送内容
                BufferedReader reader = new BufferedReader(new InputStreamReader(System.in));
                String content = reader.readLine();
                if (StringUtils.isNotEmpty(content)) {
                    if (StringUtils.equalsIgnoreCase(content, "q")) {
                        System.exit(1);
                    }
                    channel.writeAndFlush(content);
                }
//                String message = "2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 09 01 09 00 14 00 00  64 FC B6 81 9E C9 49 00 00 00 00 00 02 00 00 00 00 08 3B 9D 06 00 41 00 00 50 03 14 00 00 71 78 07 AA 5B E6 4F 00 00 00 00 00 02 00 00 00 00 08 41 65 05 00 41 00 00 51 83 14 00 00 64 50 1B 91 48 EB 4C 00 00 00 00 00 02 00 00 00 00 08 6A 94 06 00 41 00 00 30 3B 14 00 00 A6 D7 9E B7 15 F1 4E 00 00 00 00 00 02 00 00 00 00 08 C3 5F 06 00 41 00 00 50 39 14 00 00 D3 77 0C 70 36 D2 4D 00 00 00 00 00 02 00 00 00 00 08 FB 95 06 00 54 00 00 51 DF 14 00 00 62 87 C4 C2 8F F5 49 86 00 00 01 64 04 00 00 00 00 00 00 00 00 00 00 00 00 00 5F 13 00 00 99 89 F3 10 A5 F8 50 00 00 00 00 FF FF 00 00 00 00 00 96 06 01 00 00 00 00 29 0E 00 00 19 27 5B 6A 46 36 4C BA 28 3C 4D 05 82 19 DE A6 4D 3D 6E A8 BA 14 00 00 02 CB 7F 9D AE C8 50 00 00 00 00 00 00 00 00 00 00 01 72 1F 75 5C 41 00 00 5A E6 F2 3B D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 10 01  09 00 14 00 00 11 EE 27 54 D1 FE 4C 00 00 00 00 00 02 00 00 00 00 08 C4 65 05 00 41 00 00 4F 18 14 00 00 FD 6E 8B 80 C8 CD 4D 00 00 00 00 00 02 00 00 00 00 08 5B B8 07 00 41 00 00 48 5F 14 00 00 5F 6E 16 17 E0 D8 51 00 00 00 00 00 00 6D 50 60 00 01 72 1F 75 5C 59 00 00 5E A7 14 00 00 91 86 99 C7 AE F5 48 00 00 00 00 00 02 00 00 00 00 08 96 5C 05 00 41 00 00 52 6E 14 00 00 27 B4 E7 0A 45 DD 49 00 00 00 00 00 02 00 00 00 00 08 6F B3 07 00 41 00 00 4B 63 14 00 00 EE 72 C2 EB CD E3 50 BD 00 00 00 00 02 00 00 00 00 08 46 61 05 00 BD 00 00 32 A2 14 00 00 43 B7 F9 A6 AD FC 47 00 00 00 00 00 00 00 00 00 00 01 72 1F 75 5C 41 00 00 5D E1 14 00 00 FC D0 3E A9 C1 F2 53 00 00 00 00 00 02 00 00 00 00 08 4E 4A 05 00 41 00 00 33 C1 14 00 00 0D 55 06 A6 83 CC 49 00 00 00 00 00 02 00 00 00 00 08 A5 62 06 00 41 00 00 4A 78 EE 3E D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 10 01 09 00 14 00 00 08 CE E6 D8 BC F5 42 00 00 00 00 15 00 00 00 00 00 00 00 00 00 00 00 00 00 00 AD 14 00 00 99 E2 5F 09 B8 F1 4B 00 00 00 00 00 02 00 00 00 00 08 5C 5F 06 00 41 00 00 4F B9 14 00 00 58 08 8D EE 3E C5 4B 00 00 00 00 00 02 00 00 00 00 08 C1 62 06 00 41 00 00 4A 1C 14 00 00 5B 75 A4 2F BD F1 48 00 00 00 00 00 02 00 00 00 00 08 0D 5F 06 00 41 00 00 4C EB 14 00 00 EC C3 66 59 34 E3 51 00 00 00 00 00 02 00 00 00 00 08 C5 58 06 00 41 00 00 4F 27 14 00 00 3A 0F A6 90 3E C8 4F 00 00 00 00 00 02 00 00 00 00 08 F3 5F 06 00 41 00 00 56 0F 14 00 00 57 28 EA BB 0C EE 2F 00 00 00 01 0E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 B7 14 00 00 96 F3 3E 69 72 EC 4D 00 00 00 00 00 FF 79 53 60 00 01 72 1F 75 5C 64 00 00 5A 76 14 00 00 F0 21 CB E8 61 E3 4B 00 00 00 00 00 02 00 00 00 00 08 A6 57 06 00 41 00 00 4A 4E E9 38 D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 0A 01  09 00 14 00 00 62 87 C4 C2 8F F5 4C 86 00 00 01 64 04 00 00 00 00 00 00 00 00 00 00 00 00 00 5F 14 00 00 D6 E1 F6 2B AC DF 54 00 00 00 01 2D 03 00 00 00 00 00 00 00 00 00 00 00 00 00 97 0E 00 00 19 27 5B 6A 46 36 4A BA 28 3C 4D 05 82 19 DE A6 4D 3D 6E A8 BA 14 00 00 06 36 A1 1E D0 CB 4E 00 00 00 00 00 02 00 00 00 00 08 9C 62 06 00 55 00 00 45 5A 14 00 00 16 79 21 77 BA C6 51 00 00 00 00 00 02 00 00 00 00 08 D2 58 06 00 41 00 00 45 3A 14 00 00 F1 6A 10 5F F9 CC 4C 00 00 00 00 00 02 00 00 00 00 08 97 B1 07 00 41 00 00 43 91 14 00 00 0E 87 47 E8 ED EB 50 00 00 00 00 00 02 00 00 00 00 08 72 B1 07 00 41 00 00 51 66 14 00 00 D3 6E 2B DB 82 DF 53 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 35 8D 14 00 00 26 D0 8F BF F1 FF 54 00 00 00 00 00 00 00 00 00 00 01 72 1F 75 5C 41 00 00 59 E5 BA 3A D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 0A 01 09 00 14 00 00 29 9D 7A CD 60 EA 4D 00 00 00 00 00 02 00 00 00 00 08 3C 5F 06 00 41 00 00 31 A7 14 00 00 AB EC 58 0A 64 D0 51 00 00 00 00 00 02 00 00 00 00 08 AC 59 06 00 41 00 00 4C 4C 14 00 00 C4 8A E4 4D 61 D3 47 00 00 00 00 00 02 00 00 00 00 08 41 AF 07 00 41 00 00 48 52 14 00 00 FA 3F 7F 67 07 D1 4F 00 00 00 00 00 02 00 00 00 00 08 17 59 06 00 41 00 00 4E F5 0E 00 00 19 27 5B 6A 46 36 4A BA 28 3C 4D 05 82 19 DE A6 4D 3D 6E A8 BA 14 00 00 64 B9 87 41 92 C5 50 00 00 00 00 00 02 00 00 00 00 08 A6 60 06 00 41 00 00 4F 7C 14 00 00 08 CE E6 D8 BC F5 47 00 00 00 00 15 00 00 00 00 00 00 00 00 00 00 00 00 00 00 AD 14 00 00 DC 8F 40 D7 61 E2 4B 00 00 00 00 00 02 00 00 00 00 08 42 60 06 00 41 00 00 52 85 14 00 00 8F EE 9F 5B B4 E8 4B 00 00 00 00 00 02 00 00 00 00 08 ED 51 06 00 41 00 00 51 18 6E 3A D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 0E 01  09 00 14 00 00 23 F2 56 1D 41 D5 4D 00 00 00 00 00 02 00 00 00 00 08 4F 5A 06 00 41 00 00 4D AD 14 00 00 90 7E 35 6C 5D E9 54 00 00 00 00 00 02 00 00 00 00 08 57 A2 06 00 41 00 00 48 48 14 00 00 57 28 EA BB 0C EE 2D 00 00 00 01 0E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 B7 14 00 00 C3 A0 31 BE 48 C2 4C 00 00 00 00 00 02 00 00 00 00 08 B9 58 06 00 41 00 00 45 51 14 00 00 01 41 FE BD 64 F7 4A 00 00 00 00 00 02 00 00 00 00 08 DE B6 07 00 41 00 00 49 D5 14 00 00 D6 E1 F6 2B AC DF 52 00 00 00 01 2D 03 00 00 00 00 00 00 00 00 00 00 00 00 00 97 14 00 00 1C 9A 08 77 31 FF 4D 00 00 00 00 00 02 00 00 00 00 08 5A AC 07 00 41 00 00 49 4B 12 00 00 A3 1B E1 99 84 DE 26 00 00 00 00 00 FF 76 53 5F 00 00 CB B3 92 55 55 34 E3 14 00 00 DE 13 1A 47 84 C2 4E 00 00 00 00 00 00 82 55 61 00 01 75 DE 49 5C 4C 00 00 5D A0 2E 3B D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 0D 01 09 00 14 00 00 1A 7C 0F 7A 66 C7 55 00 00 00 01 2E 01 00 00 00 00 00 00 00 00 00 00 00 00 00 96 12 00 00 83 1B 36 33 2A E0 4E 00 00 00 00 00 02 00 00 00 00 05 0B FE 08 5B 41 54 0C 14 00 00 EC 84 E9 DC D1 F8 4C 00 00 00 00 00 02 00 00 00 00 08 A0 59 06 00 41 00 00 4E 42 14 00 00 4F 1A A7 10 97 C8 4E 00 00 00 00 00 02 00 00 00 00 08 18 5F 06 00 41 00 00 53 E1 14 00 00 02 CB 7F 9D AE C8 4F 00 00 00 00 00 00 00 00 00 00 01 73 1F 75 5C 41 00 00 5A E7 14 00 00 78 96 DC FB 35 E0 57 00 00 00 00 32 03 00 00 00 00 00 00 00 00 00 00 00 00 00 89 13 00 00 99 89 F3 10 A5 F8 38 00 00 00 00 FF FF 00 00 00 00 00 96 06 01 00 00 00 00 29 14 00 00 E0 69 62 E2 32 F5 52 00 00 00 00 00 02 00 00 00 00 08 46 59 06 00 41 00 00 4D A7 14 00 00 9E 86 84 74 FA EC 52 00 00 00 00 00 02 00 00 00 00 08 88 5A 06 00 41 00 00 52 75 00 38 D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 10 01 09 00  14 00 00 43 B7 F9 A6 AD FC 45 00 00 00 00 00 00 00 00 00 00 01 72 1F 75 5C 41 00 00 5D E1 14 00 00 0D 55 06 A6 83 CC 4F 00 00 00 00 00 02 00 00 00 00 08 A6 62 06 00 41 00 00 4B 7A 14 00 00 08 CE E6 D8 BC F5 40 00 00 00 00 15 00 00 00 00 00 00 00 00 00 00 00 00 00 00 AD 14 00 00 F4 1B 55 D6 B8 D6 4F 00 00 00 00 00 02 00 00 00 00 08 59 57 06 00 41 00 00 4F B4 14 00 00 45 57 81 60 6D CE 52 00 00 00 00 00 02 00 00 00 00 08 C0 63 05 00 41 00 00 50 05 14 00 00 58 08 8D EE 3E C5 4E 00 00 00 00 00 02 00 00 00 00 08 C2 62 06 00 41 00 00 4A 1F 14 00 00 E5 E0 D9 CD 75 D6 4E 00 00 00 00 00 02 00 00 00 00 08 89 5F 06 00 41 00 00 4E 6D 14 00 00 3A 0F A6 90 3E C8 4B 00 00 00 00 00 02 00 00 00 00 08 F3 5F 06 00 41 00 00 56 0F 14 00 00 71 B3 96 01 33 C9 48 00 00 00 00 00 02 00 00 00 00 08 99 57 06 00 41 00 00 4C 77 EA 37 D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 0F 01 09 00 14 00 00 57 28 EA BB 0C EE 2D 00 00 00 01 0E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 B7 14 00 00 06 36 A1 1E D0 CB 47 00 00 00 00 00 02 00 00 00 00 08 9D 62 06 00 55 00 00 45 5B 14 00 00 F1 6A 10 5F F9 CC 48 00 00 00 00 00 02 00 00 00 00 08 97 B1 07 00 41 00 00 43 91 14 00 00 D3 6E 2B DB 82 DF 55 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 35 8D 13 00 00 99 89 F3 10 A5 F8 45 00 00 00 00 FF FF 00 00 00 00 00 96 06 01 00 00 00 00 29 14 00 00 26 26 0F 07 3C F1 49 00 00 00 00 00 02 00 00 00 00 08 2D B6 07 00 53 00 00 3F 42 14 00 00 26 D0 8F BF F1 FF 54 00 00 00 00 00 00 00 00 00 00 01 73 1F 75 5C 41 00 00 59 E4 14 00 00 29 9D 7A CD 60 EA 48 00 00 00 00 00 02 00 00 00 00 08 3C 5F 06 00 41 00 00 31 A7 14 00 00 C4 8A E4 4D 61 D3 49 00 00 00 00 00 02 00 00 00 00 08 41 AF 07 00 41 00 00 48 52 AA 36 D5 2A DE 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 10 01 09 00  14 00 00 85 F5 F6 49 F8 F4 4A 00 00 00 00 00 02 00 00 00 00 08 6F A3 06 00 41 00 00 4C 75 14 00 00 96 7B FE B5 41 C5 48 00 00 00 00 00 02 00 00 00 00 08 4F 62 06 00 52 00 00 4F 84 14 00 00 B2 4C 55 66 0A C1 4F 00 00 00 00 00 02 00 00 00 00 08 BE 60 06 00 41 00 00 4C 67 14 00 00 5F F9 CF E2 EF C1 4D 00 00 00 00 00 02 00 00 00 00 08 73 AD 07 00 41 00 00 4C 66 14 00 00 16 AA DE 87 B5 EE 4B 00 00 00 00 00 02 00 00 00 00 08 D5 98 06 00 41 00 00 4E F6 14 00 00 B0 0D EB 9D FA D0 45 00 00 00 00 00 02 00 00 00 00 08 58 64 06 00 41 00 00 50 99 14 00 00 0B FD 4B E0 06 CD 46 00 00 00 00 00 02 00 00 00 00 08 D7 B7 07 00 56 00 00 3E BD 14 00 00 02 1A B3 36 72 C7 57 00 00 00 00 00 02 64 32 00 00 01 B5 98 26 5C 52 00 00 5B B3 14 00 00 08 E3 B1 ED 6A EF 51 00 00 00 00 00 02 00 00 00 00 08 3A 60 06 00 53 00 00 47 FA 39 3F D5 2A DF 00 00 00 00 00 41 80 8D 20 A9 58 6F F2 D4 00 07 00 14 00 00 0E BD C2 2E E3 E0 48 00 00 00 00 00 02 00 00 00 00 08 27 5F 06 00 41 00 00 51 DC 14 00 00 36 FE F0 F6 B8 D6 54 00 00 00 00 00 02 00 00 00 00 08 AE 65 07 00 41 00 00 4F 70 14 00 00 23 F2 56 1D 41 D5 49 00 00 00 00 00 02 00 00 00 00 08 4F 5A 06 00 41 00 00 4D AD 14 00 00 DA D9 C6 04 20 ED 4B 00 00 00 00 00 02 00 00 00 00 08 1A 5B 06 00 41 00 00 36 82 14 00 00 57 28 EA BB 0C EE 2D 00 00 00 01 0E 00 00 00 00 00 00 00 00 00 00 00 00 00 00 B7 14 00 00 DB 19 F4 41 55 C2 50 00 00 00 00 00 02 00 00 00 00 08 E4 5F 06 00 56 00 00 41 18 14 00 00 C3 A0 31 BE 48 C2 50 00 00 00 00 00 02 00 00 00 00 08 BA 58 06 00 41 00 00 45 52 A1 2C D5";
//                message = StringUtils.replace(message, " ", "");
//                log.info("send string data:{}", message+System.lineSeparator());
//                byte[] re = ByteOps.hexStringToBytes(message+System.lineSeparator());
//                channel.writeAndFlush(re);
//                log.info("send byte data:{}", re.toString());
//                Thread.sleep(2000);
            }
        } catch (InterruptedException e) {
            e.printStackTrace();
            System.exit(1);
        } finally {
            workerGroup.shutdownGracefully();
        }
    }

    public static void main(String[] args) throws Exception {
        new TcpClient("127.0.0.1", 8089).run();
    }
}
